<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
	    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	    <title></title>
	    <script src="../js/mui.min.js"></script>
	    <link href="../css/mui.min.css" rel="stylesheet"/>
	    <link href="../css/mui.listpicker.css" rel="stylesheet" />
	    <link href="../css/mui.poppicker.css" rel="stylesheet" />
	    <link href="../css/common.css" rel="stylesheet"/>
	    <link href="../css/Improve_infor.css" rel="stylesheet"/>
		<title>完善资料</title>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">完善资料</h1>
		</header>
		
		<div class="mui-content">
			<form id="testForm"  method="post">
				<div class="box_1" id="user_logo">
					<img class="upload_img" src="../images/add.png" width="65px" height="65px" />
					<span class="size">请上传工作照。</span>
				</div>
				<div class="infor">
					<span class="size loca_1">昵称</span>
					<input type="text" placeholder="ANDY" id="nickname"  required="" style="padding-left: 85%;" id="sex"/>
				</div>
				<div class="infor" st>
					<span class="size loca_1">真实姓名</span>
					<input type="text" placeholder="小三" id="name"  required="" style="padding-left: 85%;" />
				</div>
				<div style="background: #FFFFFF;border-bottom: 1px solid #E8E5E3;color: #938799;font-size: 15px;overflow: hidden;">
					<p style="float: left;margin-top: 10px;margin-left: 10px;" class="size">性别</p>
					
					<div class="mui-table-view-cell mui-radio mui-left" style="float: right;" >
						<input name="radio" type="radio" value="2">女
					</div>
					<div class="mui-table-view-cell mui-radio mui-left " style="width: 50px;float: right;margin-left: 40%;">
						<input name="radio" type="radio" value="1">男
					</div>
				</div>		
				<div class="infor">
					<span class="size loca_1">工号</span>
					<input type="text" placeholder="123" id="job_number"   required="" style="padding-left: 85%;"/>
				</div>
				<div class="infor">
					<span class="size loca_1">籍贯</span>
					<input type="text" placeholder="广东省深圳市" id="JiGuan"   required=""style="padding-left: 69%;" readonly=""/>
					<input type="hidden" name="" id="na_pr" value=""/>
					<input type="hidden" name="" id="na_city"/>
				</div>
				<div class="infor">
					<span class="size loca_1">出生</span>
					<input type="text" placeholder="1990-12-13" id="birth"   required="" style="padding-left: 72%;" readonly=""/>
				</div>
				<div class="infor">
					<span class="size loca_1">工种</span>
					<select style="height: 38px;padding-left: 80%;text-align: right;color: #938799;" required="" id="craft">
						<option value="">请选择</option>
						<option value="1">大厅</option>
						<option value="2">房间</option>
						<option value="3">美容</option>
					</select>
				</div>
				
				<div class="infor">
					<span class="size loca_1">入职</span>
					<input type="text" placeholder="2013-12-13" id="entry"  required="" style="padding-left: 72%;" readonly=""/>
				</div>
				<div style="background: #FFFFFF;border-bottom: 1px solid #E8E5E3;color: #938799;font-size: 15px;overflow: hidden;" id="language">
					<p style="float: left;margin-top: 10px;margin-left: 10px;" class="size">语言</p>
					<div class=" mui-checkbox mui-left mui-table-view-cell" style="width: 80px;">
						<input name="checkbox" type="checkbox" value="1">英语
					</div>
					<div class=" mui-checkbox mui-left mui-table-view-cell" style="width: 80px;">
						<input name="checkbox" type="checkbox" value="3">普通话
					</div>
					<div class=" mui-checkbox mui-left mui-table-view-cell" style="width: 80px;padding-left: 35px;">
						<input name="checkbox" type="checkbox" value="2">粤语
					</div>
				</div>
				
				<div class="infor">
					<span class="size loca_1">身份证号码</span>
					<input type="text" placeholder="441251362124942" id="ident"  pattern="/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/"  required="" style="padding-left: 60%;"/>
				</div>
				<div class="box_2">
					<div class="infor">
						<span class="size loca">地址</span>
					</div>
					<!--按钮选择区域-->
					<div class="mui-content-padded">
						<button id='showCityPicker' class="mui-btn mui-btn-block" type='button'>选择地区</button>
						<input type="hidden" name="" id="ad_pr"/>
						<input type="hidden" name="" id="ad_city"/>
						<input type="hidden" name="" id="ad_area"/>
					</div>
					<div class="infor">
						<input class="poll_code" type="text" placeholder="请输入详细地址" id="address"   required="" />
					</div>
				</div>
				<div class="box_2">
					<div class="infor">
						<span class="size loca">项目</span>
					</div>
					<div id="project">
						
					</div>
				</div>
				<button class="mui-btn public_btn" id="upload">提交</button>
			</form>
		</div>
	   <script src="../js/jquery-2.1.0.js"></script>
		<script src="../js/mui.listpicker.js"></script>
		<script src="../js/mui.poppicker.js"></script>
		<script src="../js/city.data.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/city.data-3.js" type="text/javascript" charset="utf-8"></script>

	   	<script src="../js/jquery-html5Validate.js" type="text/javascript"></script>
		<script src="../js/base.js" type="text/javascript" charset="utf-8"></script>
		<script>
		
				
				
		  mui.plusReady(function(){
             // 在这里调用plus api
             (function($, doc) {
				$.init();
				$.ready(function() {
					//2级联示例
					var cityPicker = new $.PopPicker({
						layer: 2
					}); 
					cityPicker.setData(cityData);
					var JiGuan = doc.getElementById('JiGuan');
					JiGuan.addEventListener('tap', function(event) {
						cityPicker.show(function(items) {
							JiGuan.value = items[0].text + items[1].text;
							var na_pr = document.querySelector('#na_pr'),
							na_city = document.querySelector('#na_city');
							na_pr.value=items[0].value;
							na_city.value=items[1].value;
						});
					}, false);
					//-----------------------------------------
					//3级联示例
					var cityPicker3 = new $.PopPicker({
						layer: 3
					}); 
					cityPicker3.setData(cityData3);
					var showCityPickerButton = doc.getElementById('showCityPicker');
					showCityPickerButton.addEventListener('tap', function(event) {
						cityPicker3.show(function(items) {
							showCityPickerButton.innerText = items[0].text + items[1].text + items[2].text;
							var ad_pr=document.querySelector('#ad_pr'),
								ad_city=document.querySelector('#ad_city'),
								ad_area=document.querySelector('#ad_area');
								ad_pr.value=items[0].value;
								ad_city.value=items[1].value;
								ad_area.value=items[2].value;
						});
					}, false);
					
				});
			})(mui, document);
			
			
			//日期选择
			$('#birth').click(function(){
				plus.nativeUI.pickDate( function(e){
					var d=e.date;
					var str= d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();
					$("#birth").val(str);
				})
			})
			
			$('#entry').click(function(){
				plus.nativeUI.pickDate( function(e){
					var d=e.date;
					var str= d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();
					$("#entry").val(str);
				})
			})
			

            // 在这里调用plus api
            var tech_id = localStorage.getItem('tech_id');
			var tech_user_id = localStorage.getItem('tech_user_id');
			//获取项目
			 mui.get('http://192.168.1.99:3000/tech/project',{user_id: 1},function(data){
						var str = "";
						for(var i = 0; i< data.length; i++){
						str	+= '<div class="mui-input-row mui-checkbox mui-left">' +
								'<label>'+data[i]['name']+'</label>' +
							    '<input  type="checkbox" value="'+data[i]['id']+'" class="good">' +
							   '</div>';
						}
						$('#project').html(str);
			 })

		
			//上传
			var server="http://192.168.1.99:3000/tech/upload";
			var files=[];
			// 上传文件
			
			$('#upload').one('click',function(){
				if(files.length<=0){
					plus.nativeUI.alert("没有添加上传文件！");
					return;
				}
				$("#testForm").html5Validate(function() {
				
									
				var task=plus.uploader.createUpload(server,
					{method:"POST"},
					function(t,status){ 
					if(status==200){
						var arr = t.responseText.split(',');
						setItem('tech_id',arr[0]);
						setItem('tech_user_id',arr[1]);
					 mui.toast('恭喜你~注册成功');
					 mui.openWindow({
						    url: 'ShangZhong.html' 
					 });
					}else{
							mui.toast('注册失败');
						}
					}
				);
				
                //获取选中的项目				
				var ck_project = [];
				var ck=ck_project.join(",")
				$('.good:checked').each(function(){
					ck_project.push($(this).val());
				})

				
				var nickname=$('#nickname').val();
				var name = $("#name").val();
				var birth=$("#birth").val();
				var job_number=$('#job_number').val();
				//获取工种
				var craft = $('#craft option:selected').val(); 
				//获取语言
				var language = [];
				$('#language input[type=checkbox]:checked').each(function(){
						language.push($(this).val());
				})
				//获取籍贯
				var na_pr = $("#na_pr").val();
				var na_city = $("#na_city").val();
				//获取地址
				var ad_pr = $('#ad_pr').val();
				var ad_city = $('#ad_city').val();
				var ad_area = $('#ad_area').val();
				var address = $('#address').val();
				//获取性别
				var sex = $('input[type=radio]:checked').val();
				var entry=$("#entry").val();
				var ident=$("#ident").val();
				var address=$("#address").val();
				var info = plus.push.getClientInfo();
				
				task.addData('name',name);
				task.addData('job_number',job_number);
				task.addData('sex',sex);
				task.addData('cid',info.clientid);
				task.addData('tech_id',tech_id);
				task.addData('ck_string',ck_project.join(","));
				task.addData( "nickname", nickname);
				task.addData( "na_pr",na_pr);
				task.addData( "na_city",na_city);
				task.addData( "ad_pr",ad_pr);
				task.addData( "ad_city",ad_city);
				task.addData( "ad_area",ad_area);
				task.addData( "birth",birth);
				task.addData( "craft",craft);
				task.addData( "entry",entry);
				task.addData( "language",language.join(","));
				task.addData( "ident",ident)
				task.addData( "address",address);
				for(var i=0;i<files.length;i++){
					var f=files[i];
					task.addFile(f.path,{key:f.name});
				}
				task.start();
				})
			})
			
				//选择工作照
				$("#user_logo").on("click",".upload_img",function(){
					var that = $(this);
					plus.gallery.pick( function (p){
						that.attr("src",p);
						appendFile(p);
					}, function ( err ) {
						mui.toast('图片选择失败');
					} );
				})
				
				// 添加文件
				var index=1;
				function appendFile(p){
					var n=p.substr(p.lastIndexOf('/')+1);
					files.push({name:"uploadkey"+index,path:p});
					index++;
				}
				
				// 产生一个随机数
				function getUid(){
					return Math.floor(Math.random()*100000000+10000000).toString();
				}
			
        });
		
			
</script>
	</body>
</html>